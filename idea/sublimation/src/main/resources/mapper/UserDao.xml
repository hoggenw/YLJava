<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.fulang.knight.dao.UserDao">
    <resultMap id="userMap" type="com.fulang.knight.entity.ListUserModel">
        <id column="user_id" property="userId" />
        <result column="user_name" property="userName" />
        <result column="password" property="password" />
        <result column="mobile" property="mobile" />
        <result column="status" property="status" />
        <result column="real_name" property="realName" />
        <result column="role_type" property="roleType" />
        <result column="driver_id" property="driverId" />
    </resultMap>


    <select id="queryByUserName" resultType="com.fulang.knight.entity.User" parameterType="String">
        SELECT
        user_id,
        user_name,
        password,
        mobile,
        real_name,
        random_string,
        status,
        create_time,
        last_login_time,
        create_by,
        update_time,
        update_by,
        remark,
        role_type,
        driver_id,
        device_id,
        recycle_type
        FROM
        tb_user
        WHERE
		user_name = #{name}
    </select>


    <select id="queryByUserId" resultType="com.fulang.knight.entity.User" parameterType="Long">
        SELECT
         user_id,
        user_name,
        password,
        mobile,
        real_name,
        random_string,
        status,
        create_time,
        last_login_time,
        create_by,
        update_time,
        update_by,
        remark,
        role_type,
        driver_id,
        device_id,
        recycle_type
        FROM
        tb_user
        WHERE
		user_id = #{userId}
    </select>


    <insert id="insertUser" parameterType="com.fulang.knight.entity.User"
            useGeneratedKeys="true" keyProperty="userId" keyColumn="user_id">
		INSERT INTO
		tb_user(user_name,
        password,
        mobile,
        real_name,
        random_string,
        status,
        create_time,
        last_login_time,
        create_by,
        update_time,
        update_by,
        remark,
        role_type,
        driver_id,
        device_id)
		VALUES
		(#{userName},#{password},#{mobile},
		#{realName},#{randomString},#{status},#{createTime},
		#{lastLoginTime},#{createBy},#{updateTime},#{updateBy},#{remark},#{roleType},#{driverId},#{deviceId})
	</insert>


    <update id="updateUserToken" parameterType="com.fulang.knight.entity.User"
            keyProperty="userId" keyColumn="user_id" useGeneratedKeys="true">
        UPDATE tb_user
        <set>
            <if test="token != null">token=#{token},</if>
            <if test="lastLoginTime != null">last_login_time=#{lastLoginTime},</if>
            <if test="tokenTime != null">token_Time=#{tokenTime},</if>
        </set>
        WHERE user_id = #{userId}
    </update>




    <select id="queryTokenUserId" resultType="com.fulang.knight.entity.User" parameterType="Long">

        SELECT
        user_id,
        token,
        token_Time,
        last_login_time
        FROM
        tb_user
        WHERE
		user_id = #{userId}
    </select>


    <update id="updateUser" parameterType="com.fulang.knight.entity.User"
            keyProperty="userId" keyColumn="user_id" useGeneratedKeys="true">
        UPDATE tb_user
        <set>
            <if test="userName != null">user_name=#{userName},</if>
            <if test="password != null">password=#{password},</if>
            <if test="mobile != null">mobile=#{mobile},</if>
            <if test="randomString != null">random_string=#{randomString},</if>
            <if test="realName != null">real_name=#{realName},</if>
            <if test="status != null">status=#{status},</if>
            <if test="roleType != null">role_type=#{roleType},</if>
            <if test="remark != null">remark=#{remark},</if>
            <if test="updateBy != null">update_by=#{updateBy},</if>
            <if test="updateTime != null">update_time=#{updateTime},</if>
            <if test="token != null">token=#{token},</if>
            <if test="tokenTime != null">token_Time=#{tokenTime},</if>
            <if test="driverId != null">driver_id=#{driverId},</if>
            <if test="deviceId != null">device_id=#{deviceId},</if>
        </set>
        WHERE user_id = #{userId}
    </update>

    <delete id="deleteUserId">
		DELETE FROM
		tb_user
		WHERE
		user_id =
		#{userId}
	</delete>


    <select id="queryUserList" resultMap="userMap">
        SELECT
        user_id,
        user_name,
        password,
        mobile,
        status,
        real_name,
        role_type
        FROM
        tb_user
        <where>
            <if
                    test="userCondition!=null
				 and userCondition.userName!=null">
                and user_name like '%${userCondition.userName}%'
            </if>
            <if
                    test="userCondition!=null
				 and userCondition.mobile!=null">
                and mobile like '%${userCondition.mobile}%'
            </if>
            <if
                    test="userCondition!=null
				 and userCondition.realName!=null">
                and real_name like '%${userCondition.realName}%'
            </if>
            <if
                    test="userCondition!=null
				 and userCondition.roleType!=null">
                and role_type =
                #{userCondition.roleType}
            </if>
        </where>
        LIMIT #{rowIndex},#{pageSize};
    </select>


    <select id="queryUserCount" resultType="int">
        SELECT count(1)
        FROM
        tb_user
        <where>
            <if
                    test="userCondition!=null
				 and userCondition.userName!=null">
                and user_name like '%${userCondition.userName}%'
            </if>
            <if
                    test="userCondition!=null
				 and userCondition.mobile!=null">
                and mobile like '%${userCondition.mobile}%'
            </if>
            <if
                    test="userCondition!=null
				 and userCondition.realName!=null">
                and real_name like '%${userCondition.realName}%'
            </if>
            <if
                    test="userCondition!=null
				 and userCondition.roleType!=null">
                and role_type =
                #{userCondition.roleType}
            </if>
        </where>
    </select>

</mapper>